# Two-Parameter-SMT
Pipeline for the analysis of chromatin and transcription factors mobility from Single Molecule Tracking (SMT) experiments

STEP BY STEP protocol
Prior to start
Install Matlab, and upload the following scripts to the user path (all publicly available): scatplot.m, SMT_classifier.m, Compare.MSD.m, msdanalyzer.m, SLIMfast.m
Single-molecule Tracking Analysis I - Tracking
A stack of .tif files generated by the microscope associated software during single-molecule imaging is used as the Input. A tracking data .txt file with the series of successive coordinates (x, y) for each single molecule motion tracks detected during the acquisition and associated timing will be generated for each .tif stack. Our protocol is optimized for Matlab-based SLIMfast.m script (Teves et al., 2016), a modified version of MTT (Sergé et al., 2008), both publicly available.
1. Start Matlab and run SLIMFast.m
2. In SLIMfast, Load > Batch to upload the .tif stacks to analyze. Once the files loaded, adjust the Optics parameters with the corresponding characteristics of the fluorophore (emission for JF549=580nm), objective (Numerical Aperture N.A.) and camera (Pixel size) used during single-molecule imaging.
3. Hit START. A progress bar for localization will pop up, representing the detection of particles in the successive frames of the .tif stack. Once detection is finished, a “Done!” box pops up. This step produces several output files, with the same name than the initial .tif stack, among which the .mat file will be used as the input of next step.
4. In SLIMfast, Load > Particle data and select an individual .mat file. An overlay of all particles detected over the course of acquisition is displayed.
a. To track the molecules frame-by-frame, in the overlay menu, hit OPT > Tracking, and change the Max. expected Diffusion Coefficient to 3 μm2/s-1.
b. Hit “GEN TRAJ” in the overlay window. A “Processing Frame” progress bar pops up. Once completed, the output files can be saves in the directory of choice. This step generates a .txt file with the same name than the initial .mat file, which will be used as an input for the two-parameter mobility analysis.
Single-molecule Tracking Analysis II – Motion Track Classification
The motion tracks will be now classified on the basis of their mean-squared displacement and motion tracks of free diffusing molecules are filtered out. The tracking .txt file generated at the previous step are converted to .csv and used as input.
The script performs several operations: 1) discarding motion tracks shorter than 5 frames, too short to be efficiently classified 2) plotting a Δ-MSD curve (or MSD=f(Δ), where Δ is the delay) for each motion track and fitting with a power law distribution to obtain the diffusion coefficient D and the scaling component α 3) classifying motions tracks based on their associated α: motion tracks are considered as confined when α≤0.7, Brownian when 0.7<α<1, or directed when α≥1
In addition, the script detects motion tracks presenting mixed Confined and Directed/Brownian behaviors, by the presence of a displacement step (or jump) at least 1.5 times superior to the average displacement within the motion track, and classify them as “Butterfly”. Butterfly motion tracks are split into Confined and Directed/Brownian segments.
An additional step of filtering is performed for confined motion tracks (including Butterfly confined segments) with motion tracks presenting with one displacement bigger than 100nm classified as false confined motions.
For each imaged nucleus, the scripts outputs 12 “msd_results” .mat files , corresponding to different subsets of classified motion tracks : All, Brownian, Directed, above (High_D) and below (Low_D) a diffusion coefficient threshold, false (confined_High_Jump) and real (confined_Low_Jump) confined, Butterfly confined (segments_confined) and directed (segments_directed) segments.
1. Gather the batch of .txt files previously generated (corresponding to the tracking data for s everal nuclei) in a unique folder and make it the directory in Matlab.
2. Run csv_converter.m, which converts each .txt file into a .csv file containing the following information (column-by-column): iteration (1-n, with n number of rows of the csv table), frame (the frame on which each single molecule was detected), time (t=frame*exposure), trajectory (Identification number of the trajectory), and x and y coordinates, in μm (see example .csv file).
3. Run SMT_Motion_Classifier.m. Select the appropriate folder and then the batch of .csv files to analyze. After execution, the script outputs a new folder starting with “MSD_results” and containing 12 .mat files (starting with “msd_results”).
Single-molecule Tracking Analysis III – Measure of the radius of confinement and of the average displacement, and mapping of the data density
The radius of confinement and the average displacement will be measured for each motion track at this step. To measure the radius of confinement, the script fits the T-MSD curves of each motion track with a circle confined diffusion model, and provides the corresponding radius of confinement RC, the diffusion coefficient at short time scales D, and a constant offset due to the localization precision limit inherent to all the localization-based microscopy methods . To discard fitting errors related to various artifacts, the trajectories with squared norm of the residual (or RSS) higher than 10-5, and radius of confinement (R) higher than 300nm are discarded at this step. As representing the circle best encompassing the motion track, rather than encompassing it strictly, the measurement of the radius of confinement is independent of the track duration. The average displacement is computed by measuring the average Euclidean distance between two consecutive positions of the molecule in each motion track The outputs of this step are 1) trackingdata.csv files, in which each row represents a motion track, with its corresponding radius of confinement (column 1), average displacement (column 2) and track duration (column 3) 2) two
representations of the radius of confinement vs average displacement assigned to each motion track: a scatter plot, and a density scatter plot (see Scatplot.m).
1. Run Compare_MSD and hit “add”. Go to the appropriate directory and open Butterfly_segments_confined.mat and confined_Low_jump_0.1.mat for the set of data to analyze. Hit “Done Selecting Files” and wait for the script to execute.
2. Save the figure generated by the script under the desired format.

See https://doi.org/10.1016/j.xpro.2020.100223 for more information. 

